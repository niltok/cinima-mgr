@page "/OrderConfirm/{OrderType:int}/{Days:int}"
@page "/OrderConfirm/{OrderType:int}/{ShowId}/{PosSelecition}"
@using cinima_mgr.Data
@using Microsoft.EntityFrameworkCore
@inject NavigationManager NavigationManager

<h3>确认订单信息</h3>
<div>
    <label> @_info </label>
</div>
<EditForm Model="model">
    <div>
        
    </div><br/>
</EditForm>
<div>
    <button @onclick="Payment" > 立即付款 </button>
    @* <Allipay Enable="" /> *@
</div>
@code {
    [Parameter]
    public int OrderType { get; set; }
    [Parameter]
    public int Days { get; set; }
    [Parameter]
    public string ShowId { get; set; }
    [Parameter]
    public string PosSelecition { get; set; }

    public List<string> _pos = new List<string>();

    public Show show;

    public string _info;
    
    public inputmodel model = new inputmodel();
    
    public class inputmodel
    {
        
    }

    protected override async Task OnInitializedAsync()
    {
        if (OrderType == 0)
        {
            await using var db = new MgrContext();
            show = (await db.Shows.Where(t => t.Id == ShowId).Include(t => t.Room).Include(t => t.Movie).ToListAsync()).ToList().First();
            int cnt = 0;
            foreach (var i in PosSelecition.ToCharArray())
            {
                if (i == '3') _pos.Add($"{cnt / show.Room.Width + 1}排{cnt % show.Room.Width + 1}座");
                cnt++;
            }

            _info = "电影名称:\t" + show.Movie.Name;
            _info += "\n日期:\t" + show.Time.ToString("MM月dd日");
            _info += "\n场次时间\t" + show.Time.ToString("hh:mm ~ ") + (show.Time + show.Movie.Duration).ToString("hh:mm");
            _info += "\n房间\t" + show.Room.Name;
            _info += "\n购票数量:\t" + _pos.Count().ToString();
            _info += "\n位置:\t";
            foreach (var i in _pos)
            {
                _info += i + "、";
            }
            if (_pos.Count() != 0) _info = _info.Substring(0, _info.Length - 1);
        }else if (OrderType == 1)
        {
            _info = $"{Days}天";
        }

    }


    async Task Payment()
    {
        // NavigationManager.NavigateTo($"//{}");NavigationManager.NavigateTo($"//{}");
    }
}